<!DOCTYPE html>
<html>
<head>
    <title>Test Package Upload</title>
</head>
<body>
    <h2>Test Cloudinary Package Upload</h2>

    <form id="uploadForm" enctype="multipart/form-data">
        <label>Package Name:</label><br>
        <input type="text" name="packageName" value="Goa Trip"><br><br>

        <label>Package Category:</label><br>
        <input type="text" name="packageCategory" value="Beach"><br><br>

        <label>Display Text:</label><br>
        <input type="text" name="displayText" value="Awesome trip package"><br><br>

        <label>Main Image:</label><br>
        <input type="file" id="mainImage"><br><br>

        <h3>Sections</h3>

        <!-- Section 0 -->
        <div>
            <label>Section 0 Heading:</label><br>
            <input type="text" id="sec0_heading" value="Day 1"><br><br>

            <label>Section 0 Description:</label><br>
            <input type="text" id="sec0_desc" value="Beach visit"><br><br>

            <label>Section 0 Image:</label><br>
            <input type="file" id="sec0_image"><br><br>
        </div>

        <!-- Section 1 -->
        <div>
            <label>Section 1 Heading:</label><br>
            <input type="text" id="sec1_heading" value="Day 2"><br><br>

            <label>Section 1 Description:</label><br>
            <input type="text" id="sec1_desc" value="Cruise ride"><br><br>

            <label>Section 1 Image:</label><br>
            <input type="file" id="sec1_image"><br><br>
        </div>

        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <pre id="responseBox"></pre>

<script>
async function submitForm() {
    const formData = new FormData();

    // ADD TEXT FIELDS
    formData.append("packageName", document.querySelector('input[name="packageName"]').value);
    formData.append("packageCategory", document.querySelector('input[name="packageCategory"]').value);
    formData.append("displayText", document.querySelector('input[name="displayText"]').value);

    // BUILD SECTIONS JSON
    const sections = [
        {
            heading: document.getElementById("sec0_heading").value,
            description: document.getElementById("sec0_desc").value
        },
        {
            heading: document.getElementById("sec1_heading").value,
            description: document.getElementById("sec1_desc").value
        }
    ];

    formData.append("sections", JSON.stringify(sections));
    

    // ADD IMAGES
    if (document.getElementById("mainImage").files[0]) {
        formData.append("mainImage", document.getElementById("mainImage").files[0]);
    }
    if (document.getElementById("sec0_image").files[0]) {
        formData.append("sectionImage_0", document.getElementById("sec0_image").files[0]);
    }
    if (document.getElementById("sec1_image").files[0]) {
        formData.append("sectionImage_1", document.getElementById("sec1_image").files[0]);
    }

    // LOG SENT DATA (debug)
    console.log(formData)
    console.log("=== Sending FormData ===");
    formData.forEach((value, key) => {
        console.log(key, value);
    });

    // SEND REQUEST
    const res = await fetch("http://localhost:3000/api/v1/save/new/package", {
        method: "POST",
        body: formData
    });

    const data = await res.json();
    document.getElementById("responseBox").textContent = JSON.stringify(data, null, 2);
}
</script>

</body>
</html>
